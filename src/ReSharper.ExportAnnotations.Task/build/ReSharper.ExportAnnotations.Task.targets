<Project>

  <PropertyGroup>
    <MSBuildAllProjects Condition="'$(MSBuildToolsVersion)' != 'Current'">$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>

  <!-- Unless set otherwise, ExportJetBrainsAnnotations is true for libraries, false for other projects. -->
  <PropertyGroup Condition="'$(ExportJetBrainsAnnotations)' == ''">
    <ExportJetBrainsAnnotations Condition="'$(OutputType)' != 'Library'">false</ExportJetBrainsAnnotations>
    <ExportJetBrainsAnnotations Condition="'$(OutputType)' == 'Library'">true</ExportJetBrainsAnnotations>
  </PropertyGroup>
  <PropertyGroup>
    <ExportJetBrainsAnnotations Condition="'$(ExportJetBrainsAnnotations)' != 'true'">false</ExportJetBrainsAnnotations>
  </PropertyGroup>

  <!-- Unless set otherwise, StripJetBrainsAnnotations is true. -->
  <PropertyGroup>
    <StripJetBrainsAnnotations Condition="'$(StripJetBrainsAnnotations)' == ''">true</StripJetBrainsAnnotations>
    <StripJetBrainsAnnotations Condition="'$(StripJetBrainsAnnotations)' != 'true'">false</StripJetBrainsAnnotations>
  </PropertyGroup>

  <Import Condition="'$(RebuildingWithoutJetBrainsAnnotations)' != 'true'"
          Project="ReSharper.ExportAnnotations.Task.Building.targets" />

  <Import Condition="'$(RebuildingWithoutJetBrainsAnnotations)' == 'true'"
          Project="ReSharper.ExportAnnotations.Task.Rebuilding.targets" />

  <!-- Add external annotations file to package -->
  <PropertyGroup Condition="$(ExportJetBrainsAnnotations)">
    <TargetsForTfmSpecificContentInPackage>$(TargetsForTfmSpecificContentInPackage);_ExportAnnotations_IncludeExternalAnnotationsInPackage</TargetsForTfmSpecificContentInPackage>
  </PropertyGroup>

  <Target Name="_ExportAnnotations_IncludeExternalAnnotationsInPackage"
          Condition="$(ExportJetBrainsAnnotations)">

    <ItemGroup>
      <TfmSpecificPackageFile Include="$(OutputPath)\$(AssemblyName).ExternalAnnotations.xml" PackagePath="lib/$(TargetFramework)" />
    </ItemGroup>

  </Target>

</Project>